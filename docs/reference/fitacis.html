<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fit multiple A-Ci curves at once — fitacis â€¢ plantecophys</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">plantecophys</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/fitaci-FAQ.html">Fitting A-Ci curves - FAQ</a>
    </li>
    <li>
      <a href="../articles/Introduction_to_fitaci.html">Introduction to fitaci</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fit multiple A-Ci curves at once</h1>
    </div>

    
    <p>A convenient function to fit many curves at once, by calling <code><a href='fitaci.html'>fitaci</a></code> for every group in the dataset. The data provided must include a variable that uniquely identifies each A-Ci curve.</p>
    

    <pre class="usage"><span class='fu'>fitacis</span>(<span class='no'>data</span>, <span class='no'>group</span>, <span class='kw'>fitmethod</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"default"</span>, <span class='st'>"bilinear"</span>),
  <span class='kw'>progressbar</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>quiet</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>id</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>...</span>)

<span class='co'># S3 method for acifits</span>
<span class='fu'>plot</span>(<span class='no'>x</span>, <span class='kw'>how</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"manyplots"</span>, <span class='st'>"oneplot"</span>), <span class='kw'>highlight</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>ylim</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>xlim</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>add</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>what</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"model"</span>, <span class='st'>"data"</span>,
  <span class='st'>"none"</span>), <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data</th>
      <td><p>Dataframe with Ci, Photo, Tleaf, PPFD (the last two are optional). For <code>fitacis</code>, also requires a grouping variable.</p></td>
    </tr>
    <tr>
      <th>group</th>
      <td><p>The name of the grouping variable in the dataframe (an A-Ci curve will be fit for each group separately).</p></td>
    </tr>
    <tr>
      <th>fitmethod</th>
      <td><p>Method to fit the A-Ci curve. Either 'default' (Duursma 2015), or 'bilinear'. See Details.</p></td>
    </tr>
    <tr>
      <th>progressbar</th>
      <td><p>Display a progress bar (default is TRUE).</p></td>
    </tr>
    <tr>
      <th>quiet</th>
      <td><p>If TRUE, no messages are written to the screen.</p></td>
    </tr>
    <tr>
      <th>id</th>
      <td><p>Names of variables (quoted, can be a vector) in the original dataset to return as part of the coef() statement. Useful for keeping track of species names, treatment levels, etc. See Details and Examples.</p></td>
    </tr>
    <tr>
      <th>&#8230;</th>
      <td><p>Further arguments passed to <code><a href='fitaci.html'>fitaci</a></code> (in the case of <code>fitacis</code>), or <code><a href='fitaci.html'>plot.acifit</a></code> (in the case of <code>plot.acifits</code>).</p></td>
    </tr>
    <tr>
      <th>x</th>
      <td><p>For <code>plot.acifits</code>, an object returned from <code>fitacis</code></p></td>
    </tr>
    <tr>
      <th>how</th>
      <td><p>If 'manyplots', produces a single plot for each A-Ci curve. If 'oneplot' overlays all of them.</p></td>
    </tr>
    <tr>
      <th>highlight</th>
      <td><p>If a name of a curve is given (check names(object), where object is returned by acifits), all curves are plotted in grey, with the highlighted one on top.</p></td>
    </tr>
    <tr>
      <th>xlim, ylim</th>
      <td><p>The X and Y axis limits.</p></td>
    </tr>
    <tr>
      <th>add</th>
      <td><p>If TRUE, adds the plots to a current plot.</p></td>
    </tr>
    <tr>
      <th>what</th>
      <td><p>What to plot, either 'model' (the fitted curve), 'data' or 'none'. See examples.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><strong>Troubleshooting - </strong> When using the default fitting method (see <code><a href='fitaci.html'>fitaci</a></code>), it is common that some curves cannot be fit. Usually this indicates that the curve is poor quality and should not be used to estimate photosynthetic capacity, but there are exceptions. The <code>fitacis</code> function now refits the non-fitting curves with the 'bilinear' method (see <code>fitaci</code>), which will always return parameter estimates (for better or worse).
    <strong>Summarizing and plotting - </strong> Like <code>fitaci</code>, the batch utility <code>fitacis</code> also has a standard plotting method. By default, it will make a single plot for every curve that you fit (thus generating many plots). Alternatively, use the setting <code>how="oneplot"</code> (see Examples below) for a single plot. The fitted <strong>coefficients</strong> are extracted with <code>coef</code>, which gives a dataframe where each row represents a fitted curve (the grouping label is also included).
    <strong>Adding identifying variables - </strong> after fitting multiple curves, the most logical next step is to analyze the coefficient by some categorical variable (species, treatment, location). You can use the <code>id</code> argument to store variables from the original dataset in the output. It is important that the 'id' variables take only one value per fitted curve, if this is not the case only the first value of the curve will be stored (this will be rarely useful). See examples.</p>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Duursma, R.A., 2015. Plantecophys - An R Package for Analysing and Modelling Leaf Gas Exchange Data. PLoS ONE 10, e0143346. doi:10.1371/journal.pone.0143346</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='co'># Fit many curves (using an example dataset)</span>
<span class='co'># The bilinear method is much faster, but compare using 'default'!</span>
<span class='no'>fits</span> <span class='kw'>&lt;-</span> <span class='fu'>fitacis</span>(<span class='no'>manyacidat</span>, <span class='st'>"Curve"</span>, <span class='kw'>fitmethod</span><span class='kw'>=</span><span class='st'>"bilinear"</span>)</div><div class='output co'>#&gt;   |                                                          |                                                  |   0%  |                                                          |==                                                |   4%  |                                                          |====                                              |   7%  |                                                          |=====                                             |  11%  |                                                          |=======                                           |  14%  |                                                          |=========                                         |  18%  |                                                          |===========                                       |  21%  |                                                          |============                                      |  25%  |                                                          |==============                                    |  29%  |                                                          |================                                  |  32%  |                                                          |==================                                |  36%  |                                                          |====================                              |  39%  |                                                          |=====================                             |  43%  |                                                          |=======================                           |  46%  |                                                          |=========================                         |  50%  |                                                          |===========================                       |  54%  |                                                          |=============================                     |  57%  |                                                          |==============================                    |  61%  |                                                          |================================                  |  64%  |                                                          |==================================                |  68%  |                                                          |====================================              |  71%  |                                                          |======================================            |  75%  |                                                          |=======================================           |  79%  |                                                          |=========================================         |  82%  |                                                          |===========================================       |  86%  |                                                          |=============================================     |  89%  |                                                          |==============================================    |  93%  |                                                          |================================================  |  96%  |                                                          |==================================================| 100%</div><div class='input'><span class='fu'>with</span>(<span class='fu'>coef</span>(<span class='no'>fits</span>), <span class='fu'>plot</span>(<span class='no'>Vcmax</span>, <span class='no'>Jmax</span>))</div><div class='img'><img src='fitacis-1.png' alt='' width='700' height='432.632880098887' /></div><div class='input'>
<span class='co'># The resulting object is a list, with each component an object as returned by fitaci</span>
<span class='co'># So, we can extract one curve:</span>
<span class='no'>fits</span><span class='kw'>[[</span><span class='fl'>1</span>]]</div><div class='output co'>#&gt; Result of fitaci.
#&gt; 
#&gt; Data and predictions:
#&gt;            Ci      Ameas     Amodel         Ac        Aj   Ap        Rd VPD
#&gt; 2    53.23129 -0.4401082  0.1014381  0.9601119  2.548123 1000 0.8586158 1.5
#&gt; 3    79.47367  2.4824630  2.1937702  3.0526198  7.036734 1000 0.8586158 1.5
#&gt; 4   116.74688  5.4531712  4.9419337  5.8011511 11.392394 1000 0.8586158 1.5
#&gt; 5   188.00801  9.7099879  9.5705964 10.4310194 16.447715 1000 0.8586158 1.5
#&gt; 6   278.44662 14.8225766 14.4261545 15.2897486 19.977583 1000 0.8586158 1.5
#&gt; 7   343.03259 17.7982155 17.4602014 18.3289218 21.639847 1000 0.8586158 1.5
#&gt; 1   344.72152 17.9244012 17.3165146 18.1849643 21.534276 1000 0.8586158 1.5
#&gt; 14  344.74839 16.7933747 17.6853306 18.5545917 21.774261 1000 0.8586158 1.5
#&gt; 8   588.08078 23.8925326 24.1309683 27.0327638 25.020148 3000 0.8586158 1.5
#&gt; 9   833.25547 26.5674409 25.7783026 33.0856065 26.647921 3000 0.8586158 1.5
#&gt; 10 1136.99222 25.9787890 26.8108335 38.1296944 27.676768 3000 0.8586158 1.5
#&gt; 11 1436.86370 26.6110657 27.5409345 42.0628463 28.405453 3000 0.8586158 1.5
#&gt; 12 1536.46772 27.4018784 27.7965881 43.3773689 28.660781 3000 0.8586158 1.5
#&gt; 13 1731.76400 28.6752069 28.0952804 45.2475932 28.959041 3000 0.8586158 1.5
#&gt;       Tleaf         Cc     PPFD Patm Ci_original
#&gt; 2  24.55873   53.23139 1799.959  100    53.23129
#&gt; 3  24.58292   79.47586 1799.590  100    79.47367
#&gt; 4  24.71278  116.75183 1799.819  100   116.74688
#&gt; 5  24.73687  188.01759 1800.371  100   188.00801
#&gt; 6  24.67508  278.46106 1800.233  100   278.44662
#&gt; 7  24.76596  343.05006 1799.575  100   343.03259
#&gt; 1  24.51593  344.73886 1800.356  100   344.72152
#&gt; 14 24.94098  344.76609 1799.964  100   344.74839
#&gt; 8  24.83785  588.10494 1799.477  100   588.08078
#&gt; 9  24.91185  833.28127 1799.969  100   833.25547
#&gt; 10 24.87314 1137.01906 1799.525  100  1136.99222
#&gt; 11 24.95914 1436.89126 1799.615  100  1436.86370
#&gt; 12 25.04542 1536.49554 1799.784  100  1536.46772
#&gt; 13 25.07566 1731.79212 1799.160  100  1731.76400
#&gt; 
#&gt; Root mean squared error:  2.196037 
#&gt; 
#&gt; Estimated parameters:
#&gt;          Estimate Std. Error
#&gt; Vcmax  65.0009909  1.3720635
#&gt; Jmax  131.7980133         NA
#&gt; Rd      0.8586158  0.2876248
#&gt; Note: Vcmax, Jmax are at 25C, Rd is at measurement T.
#&gt; 
#&gt; Curve was fit using method:  bilinear 
#&gt; 
#&gt; Parameter settings:
#&gt; Patm = 100
#&gt;  alpha = 0.24
#&gt;  theta = 0.85
#&gt;  EaV = 82620.87
#&gt;  EdVC = 0
#&gt;  delsC = 645.1013
#&gt;  EaJ = 39676.89
#&gt;  EdVJ = 2e+05
#&gt;  delsJ = 641.3615
#&gt; 
#&gt; Estimated from Tleaf (shown at mean Tleaf):
#&gt; GammaStar =  42.31453 
#&gt; Km =  698.2084 </div><div class='input'><span class='fu'>plot</span>(<span class='no'>fits</span><span class='kw'>[[</span><span class='fl'>1</span>]])</div><div class='img'><img src='fitacis-2.png' alt='' width='700' height='432.632880098887' /></div><div class='input'>
<span class='co'># Plot all curves in separate figures with plot(fits)</span>
<span class='co'># Or, in one plot:</span>
<span class='fu'>plot</span>(<span class='no'>fits</span>, <span class='kw'>how</span><span class='kw'>=</span><span class='st'>"oneplot"</span>)</div><div class='img'><img src='fitacis-3.png' alt='' width='700' height='432.632880098887' /></div><div class='input'>
<span class='co'># Note that parameters can be passed to plot.acifit. For example,</span>
<span class='fu'>plot</span>(<span class='no'>fits</span>, <span class='kw'>how</span><span class='kw'>=</span><span class='st'>"oneplot"</span>, <span class='kw'>what</span><span class='kw'>=</span><span class='st'>"data"</span>, <span class='kw'>col</span><span class='kw'>=</span><span class='st'>"blue"</span>)</div><div class='input'><span class='fu'>plot</span>(<span class='no'>fits</span>, <span class='kw'>how</span><span class='kw'>=</span><span class='st'>"oneplot"</span>, <span class='kw'>add</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>what</span><span class='kw'>=</span><span class='st'>"model"</span>, <span class='kw'>lwd</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='fl'>1</span>,<span class='fl'>1</span>))</div><div class='img'><img src='fitacis-4.png' alt='' width='700' height='432.632880098887' /></div><div class='input'>
<span class='co'># Other elements can be summarized with sapply. For example, look at the RMSE:</span>
<span class='no'>rmses</span> <span class='kw'>&lt;-</span> <span class='fu'>sapply</span>(<span class='no'>fits</span>, <span class='st'>"[["</span>, <span class='st'>"RMSE"</span>)
<span class='fu'>plot</span>(<span class='no'>rmses</span>, <span class='kw'>type</span><span class='kw'>=</span><span class='st'>'h'</span>, <span class='kw'>ylab</span><span class='kw'>=</span><span class='st'>"RMSE"</span>, <span class='kw'>xlab</span><span class='kw'>=</span><span class='st'>"Curve nr"</span>)</div><div class='img'><img src='fitacis-5.png' alt='' width='700' height='432.632880098887' /></div><div class='input'>
<span class='co'># And plot the worst-fitting curve:</span>
<span class='fu'>plot</span>(<span class='no'>fits</span><span class='kw'>[[</span><span class='fu'>which.max</span>(<span class='no'>rmses</span>)]])</div><div class='img'><img src='fitacis-6.png' alt='' width='700' height='432.632880098887' /></div><div class='input'>
<span class='co'># It is very straightforward to summarize the coefficients by a factor variable</span>
<span class='co'># that was contained in the original data. In manyacidat, there is a factor variable</span>
<span class='co'># 'treatment'.</span>
<span class='co'># We first have to refit the curves, using the 'id' argument:</span>
<span class='no'>fits</span> <span class='kw'>&lt;-</span> <span class='fu'>fitacis</span>(<span class='no'>manyacidat</span>, <span class='st'>"Curve"</span>, <span class='kw'>fitmethod</span><span class='kw'>=</span><span class='st'>"bilinear"</span>, <span class='kw'>id</span><span class='kw'>=</span><span class='st'>"treatment"</span>)</div><div class='output co'>#&gt;   |                                                          |                                                  |   0%  |                                                          |==                                                |   4%  |                                                          |====                                              |   7%  |                                                          |=====                                             |  11%  |                                                          |=======                                           |  14%  |                                                          |=========                                         |  18%  |                                                          |===========                                       |  21%  |                                                          |============                                      |  25%  |                                                          |==============                                    |  29%  |                                                          |================                                  |  32%  |                                                          |==================                                |  36%  |                                                          |====================                              |  39%  |                                                          |=====================                             |  43%  |                                                          |=======================                           |  46%  |                                                          |=========================                         |  50%  |                                                          |===========================                       |  54%  |                                                          |=============================                     |  57%  |                                                          |==============================                    |  61%  |                                                          |================================                  |  64%  |                                                          |==================================                |  68%  |                                                          |====================================              |  71%  |                                                          |======================================            |  75%  |                                                          |=======================================           |  79%  |                                                          |=========================================         |  82%  |                                                          |===========================================       |  86%  |                                                          |=============================================     |  89%  |                                                          |==============================================    |  93%  |                                                          |================================================  |  96%  |                                                          |==================================================| 100%</div><div class='input'>
<span class='co'># And now use this to plot Vcmax by treatment.</span>
<span class='fu'>boxplot</span>(<span class='no'>Vcmax</span> ~ <span class='no'>treatment</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='fu'>coef</span>(<span class='no'>fits</span>), <span class='kw'>ylim</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='fl'>0</span>,<span class='fl'>130</span>))</div><div class='img'><img src='fitacis-7.png' alt='' width='700' height='432.632880098887' /></div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#details">Details</a></li>

      <li><a href="#references">References</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by <a href='http://www.remkoduursma.com'>Remko Duursma</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
